# Zino's Chat ä¼˜åŒ–è®¡åˆ’

## ğŸ“‹ éœ€æ±‚æ€»è§ˆ

### åŸå§‹éœ€æ±‚
1. è¯­éŸ³ç”Ÿæˆæ¨¡å‹æ•ˆæœç”Ÿç¡¬ï¼Œéœ€è¦æ›´è‡ªç„¶çš„ TTS
2. RAG ç³»ç»Ÿæ£€ç´¢é‡å¤ï¼Œç¼ºä¹å¤šæ ·æ€§
3. éœ€è¦æ–°å¢æ™ºèƒ½ä½“å®æ—¶æŸ¥è¯¢å¹¶æ•´åˆç»“æœ

---

## âœ¨ ä¼˜åŒ–åçš„éœ€æ±‚è¡¨è¿°

### éœ€æ±‚ 1ï¼šè‡ªç„¶è¯­éŸ³åˆæˆç³»ç»Ÿå‡çº§

**é—®é¢˜æè¿°**ï¼š
- å½“å‰ä½¿ç”¨ gTTS ç”Ÿæˆçš„è¯­éŸ³ç¼ºä¹æƒ…æ„Ÿè¡¨è¾¾å’Œè‡ªç„¶åœé¡¿
- 1.3 å€åŠ é€Ÿå¤„ç†è™½ç„¶æå‡æ´»æ³¼åº¦ï¼Œä½†æ— æ³•è§£å†³æ ¹æœ¬é—®é¢˜
- ç¼ºå°‘å¯¹è¯­è°ƒã€é‡éŸ³ã€æƒ…æ„Ÿçš„ç²¾ç»†æ§åˆ¶

**ç›®æ ‡**ï¼š
- é›†æˆå…·å¤‡é«˜è‡ªç„¶åº¦çš„ TTS å¼•æ“ï¼Œæ”¯æŒæƒ…æ„Ÿè¡¨è¾¾
- ä¿æŒå½“å‰çš„éŸ³é¢‘å¤„ç†æµç¨‹ï¼ˆBase64 ç¼–ç  + HTML5 æ’­æ”¾ï¼‰
- æœ€å°åŒ–ä»£ç æ”¹åŠ¨ï¼Œä¿è¯å‘åå…¼å®¹
- æ§åˆ¶ API è°ƒç”¨æˆæœ¬ï¼Œé€‚åˆæ•™è‚²åœºæ™¯é•¿æœŸè¿è¡Œ

**æˆåŠŸæ ‡å‡†**ï¼š
- è¯­éŸ³è‡ªç„¶åº¦ä¸»è§‚è¯„åˆ†æå‡ 60%+
- é›†æˆæ”¹åŠ¨ä»£ç è¡Œæ•° < 50 è¡Œ
- å•æ¬¡ TTS è°ƒç”¨å»¶è¿Ÿ < 2 ç§’
- æœˆåº¦æˆæœ¬å¯æ§ï¼ˆç›®æ ‡ < $50 for 10K interactionsï¼‰

---

### éœ€æ±‚ 2ï¼šRAG æ£€ç´¢å¤šæ ·æ€§ä¸ç›¸å…³æ€§å¢å¼º

**é—®é¢˜æè¿°**ï¼š
- å½“å‰ä½¿ç”¨ MMR (Maximal Marginal Relevance) ç®—æ³•ï¼Œä½†å‚æ•° `lambda_mult=1` å¯¼è‡´å®Œå…¨ä¼˜å…ˆç›¸ä¼¼åº¦è€Œéå¤šæ ·æ€§
- `k=2, fetch_k=6` æ£€ç´¢é‡è¿‡å°ï¼Œä¸”æœªä½¿ç”¨é‡æ’åºæœºåˆ¶
- ç¼ºå°‘å¯¹è¯å†å²ä¸Šä¸‹æ–‡ï¼Œå¯¼è‡´åç»­é—®é¢˜æ£€ç´¢åˆ°ç›¸åŒæ–‡æ¡£
- æ²¡æœ‰è´Ÿé¢è¿‡æ»¤æœºåˆ¶ï¼Œå¯èƒ½æ£€ç´¢åˆ°ä¸ç›¸å…³ç‰‡æ®µ

**ç›®æ ‡**ï¼š
- å®ç°æ··åˆæ£€ç´¢ç­–ç•¥ï¼ˆå‘é‡æ£€ç´¢ + å…³é”®è¯æ£€ç´¢ + é‡æ’åºï¼‰
- å¼•å…¥å¯¹è¯å†å²æ„ŸçŸ¥çš„ä¸Šä¸‹æ–‡æ£€ç´¢
- æ·»åŠ æ£€ç´¢ç»“æœå»é‡å’Œå¤šæ ·æ€§æ§åˆ¶
- ä¿æŒ ChromaDB å‘é‡åº“ä¸å˜ï¼Œä»…ä¼˜åŒ–æ£€ç´¢é€»è¾‘

**æˆåŠŸæ ‡å‡†**ï¼š
- è¿ç»­ 5 è½®å¯¹è¯ä¸å‡ºç°å®Œå…¨ç›¸åŒçš„æ£€ç´¢ç»“æœ
- æ£€ç´¢ç›¸å…³æ€§è¯„åˆ†ï¼ˆäººå·¥æ ‡æ³¨ï¼‰æå‡ 40%+
- æ£€ç´¢å»¶è¿Ÿå¢åŠ  < 500ms
- ä»£ç æ”¹åŠ¨é›†ä¸­åœ¨æ£€ç´¢å‡½æ•°ï¼Œä¸å½±å“å…¶ä»–æ¨¡å—

---

### éœ€æ±‚ 3ï¼šæ··åˆæ™ºèƒ½ä½“ - å®æ—¶çŸ¥è¯†å¢å¼ºç³»ç»Ÿ

**é—®é¢˜æè¿°**ï¼š
- RAG ä»…èƒ½æ£€ç´¢é¢„ç½®çš„ PDF çŸ¥è¯†åº“ï¼ˆdb5/ï¼‰ï¼Œæ— æ³•è·å–å®æ—¶ä¿¡æ¯
- ç¼ºå°‘é’ˆå¯¹ç‰¹å®šé—®é¢˜çš„å¤–éƒ¨èµ„æºæŸ¥è¯¢èƒ½åŠ›
- ç”¨æˆ·é—®é¢˜è¶…å‡ºçŸ¥è¯†åº“èŒƒå›´æ—¶ï¼Œå›ç­”è´¨é‡ä¸‹é™
- æ²¡æœ‰è‡ªåŠ¨åˆ¤æ–­ä½•æ—¶éœ€è¦å¤–éƒ¨æŸ¥è¯¢çš„æœºåˆ¶

**ç›®æ ‡**ï¼š
- æ–°å¢æ™ºèƒ½è·¯ç”±å±‚ï¼Œåˆ¤æ–­é—®é¢˜æ˜¯å¦éœ€è¦å¤–éƒ¨æŸ¥è¯¢
- é›†æˆå®æ—¶æœç´¢å·¥å…·ï¼ˆä¼˜å…ˆ Tavily API / DuckDuckGoï¼‰
- å®ç° RAG ç»“æœ + æœç´¢ç»“æœçš„æ™ºèƒ½èåˆ
- ä¿ç•™äº‹å®æ ¸æŸ¥åŠŸèƒ½ï¼Œæ ‡æ³¨ä¿¡æ¯æ¥æºï¼ˆå†…éƒ¨ vs å¤–éƒ¨ï¼‰

**æˆåŠŸæ ‡å‡†**ï¼š
- å¯¹è¶…èŒƒå›´é—®é¢˜çš„å›ç­”å‡†ç¡®ç‡ä» 30% æå‡åˆ° 75%+
- æ™ºèƒ½è·¯ç”±å†³ç­–å‡†ç¡®ç‡ > 85%
- æ–°å¢åŠŸèƒ½ä¸å½±å“ç°æœ‰ RAG æµç¨‹æ€§èƒ½
- UI ä¸­æ˜ç¡®åŒºåˆ†çŸ¥è¯†æ¥æºï¼ˆçŸ¥è¯†åº“ vs å®æ—¶æœç´¢ï¼‰

---

## ğŸ”§ æŠ€æœ¯æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šTTS ç³»ç»Ÿå‡çº§

#### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | è‡ªç„¶åº¦ | é›†æˆéš¾åº¦ | æˆæœ¬ | æ¨èåº¦ |
|------|--------|---------|------|--------|
| **OpenAI TTS** | â­â­â­â­â­ | â­â­â­â­â­ | $15/1Må­—ç¬¦ | âœ… é¦–é€‰ |
| ElevenLabs | â­â­â­â­â­ | â­â­â­â­ | $22-99/æœˆ | âš ï¸ é«˜æˆæœ¬ |
| Azure Speech | â­â­â­â­ | â­â­â­ | $16/1Må­—ç¬¦ | å¤‡é€‰ |
| Coqui TTS (å¼€æº) | â­â­â­ | â­â­ | å…è´¹ | æŠ€æœ¯å¤æ‚ |

#### æ¨èæ–¹æ¡ˆï¼š**OpenAI TTS**

**ç†ç”±**ï¼š
- å·²ä½¿ç”¨ OpenAI APIï¼Œæ— éœ€é¢å¤–è®¤è¯
- æ”¯æŒ 6 ç§é¢„è®­ç»ƒè¯­éŸ³ï¼ˆæ¨è `nova` - å¥³æ€§ã€æ´»æ³¼ï¼‰
- åŸç”Ÿæ”¯æŒæµå¼è¾“å‡ºå’Œå¤šç§æ ¼å¼
- ä¸ç°æœ‰ä»£ç é«˜åº¦å…¼å®¹

**å®ç°è¦ç‚¹**ï¼š
```python
from openai import OpenAI
client = OpenAI()

def speak_text_v2(text):
    response = client.audio.speech.create(
        model="tts-1",  # æˆ– tts-1-hd è·å¾—æ›´é«˜è´¨é‡
        voice="nova",   # Maria çš„æ´»æ³¼è¯­éŸ³
        input=text,
        speed=1.1       # æ›¿ä»£ pydub åŠ é€Ÿ
    )
    # ä¿æŒç°æœ‰çš„ Base64 + HTML5 æ’­æ”¾é€»è¾‘
```

---

### æ–¹æ¡ˆ 2ï¼šRAG æ£€ç´¢ä¼˜åŒ–

#### ä¼˜åŒ–ç­–ç•¥

**2.1 å¤šæ ·æ€§å‚æ•°è°ƒä¼˜**
```python
# å½“å‰ï¼ˆé—®é¢˜æ‰€åœ¨ï¼‰
vectordb.max_marginal_relevance_search(query, k=2, fetch_k=6, lambda_mult=1)
# lambda_mult=1 å®Œå…¨å¿½ç•¥å¤šæ ·æ€§

# ä¼˜åŒ–æ–¹æ¡ˆ
vectordb.max_marginal_relevance_search(
    query, 
    k=4,           # å¢åŠ æ£€ç´¢é‡
    fetch_k=20,    # æ‰©å¤§å€™é€‰æ± 
    lambda_mult=0.5  # å¹³è¡¡ç›¸ä¼¼åº¦å’Œå¤šæ ·æ€§
)
```

**2.2 å¼•å…¥é‡æ’åºæœºåˆ¶**

ä½¿ç”¨ Cohere Rerankï¼ˆæˆ–å¼€æºæ›¿ä»£ FlashRankï¼‰ï¼š
```python
from langchain.retrievers import ContextualCompressionRetriever
from langchain.retrievers.document_compressors import CohereRerank

compressor = CohereRerank(model="rerank-english-v3.0", top_n=3)
compression_retriever = ContextualCompressionRetriever(
    base_compressor=compressor,
    base_retriever=vectordb.as_retriever()
)
```

**2.3 å¯¹è¯å†å²è¿‡æ»¤**
```python
def deduplicate_with_history(new_docs, chat_history):
    """åŸºäºå¯¹è¯å†å²å»é‡"""
    used_doc_ids = set()
    for msg in chat_history:
        if 'retrieved_doc_ids' in msg:
            used_doc_ids.update(msg['retrieved_doc_ids'])
    
    return [doc for doc in new_docs if doc.metadata.get('id') not in used_doc_ids]
```

**2.4 æ··åˆæ£€ç´¢ï¼ˆHybrid Searchï¼‰**

ç»“åˆå‘é‡æ£€ç´¢å’Œå…³é”®è¯æ£€ç´¢ï¼š
```python
from langchain.retrievers import EnsembleRetriever
from langchain.retrievers import BM25Retriever

# å‘é‡æ£€ç´¢å™¨
vector_retriever = vectordb.as_retriever(search_kwargs={"k": 3})

# å…³é”®è¯æ£€ç´¢å™¨
bm25_retriever = BM25Retriever.from_documents(all_docs)
bm25_retriever.k = 3

# æ··åˆæ£€ç´¢ï¼ˆ0.6 å‘é‡ + 0.4 å…³é”®è¯ï¼‰
ensemble_retriever = EnsembleRetriever(
    retrievers=[vector_retriever, bm25_retriever],
    weights=[0.6, 0.4]
)
```

#### æ¨èæ–¹æ¡ˆç»„åˆï¼š
1. **é˜¶æ®µä¸€ï¼ˆå¿«é€Ÿæ”¹è¿›ï¼‰**ï¼šè°ƒæ•´ MMR å‚æ•° + å¯¹è¯å†å²å»é‡
2. **é˜¶æ®µäºŒï¼ˆæ·±åº¦ä¼˜åŒ–ï¼‰**ï¼šå¼•å…¥é‡æ’åº + æ··åˆæ£€ç´¢

---

### æ–¹æ¡ˆ 3ï¼šæ™ºèƒ½ä½“å®æ—¶æŸ¥è¯¢ç³»ç»Ÿ

#### æ¶æ„è®¾è®¡

```
ç”¨æˆ·é—®é¢˜
    â†“
[æ™ºèƒ½è·¯ç”±å™¨] â† LLM åˆ¤æ–­ï¼šéœ€è¦å¤–éƒ¨ä¿¡æ¯å—ï¼Ÿ
    â†“
    â”œâ”€â”€ Yes â†’ [å®æ—¶æœç´¢å·¥å…·] â†’ [ç»“æœèåˆå™¨] â†’ æœ€ç»ˆå›ç­”
    â”‚              â†“
    â”‚         [Tavily/DuckDuckGo]
    â”‚
    â””â”€â”€ No â†’ [RAG æ£€ç´¢] â†’ ä¼ ç»Ÿæµç¨‹
```

#### å·¥å…·é€‰æ‹©

| å·¥å…· | ä¼˜åŠ¿ | æˆæœ¬ | æ¨èåº¦ |
|------|------|------|--------|
| **Tavily API** | ä¸“ä¸º AI è®¾è®¡ï¼Œç»“æ„åŒ–è¾“å‡º | $0.005/query | âœ… é¦–é€‰ |
| DuckDuckGo | å®Œå…¨å…è´¹ï¼Œæ— é™è°ƒç”¨ | å…è´¹ | å¤‡é€‰ |
| Google Custom Search | é«˜è´¨é‡ç»“æœ | $5/1000 queries | æˆæœ¬é«˜ |

#### å®ç°æ–¹æ¡ˆï¼šåŸºäº LangChain Tools

```python
from langchain.agents import initialize_agent, Tool
from langchain_community.tools import TavilySearchResults

# å®šä¹‰å·¥å…·
search = TavilySearchResults(max_results=3)

tools = [
    Tool(
        name="knowledge_base",
        func=lambda q: vectordb.similarity_search(q, k=3),
        description="æŸ¥è¯¢ Zino's Petrel çš„ä¸“ä¸šçŸ¥è¯†åº“"
    ),
    Tool(
        name="web_search",
        func=search.run,
        description="æœç´¢æœ€æ–°çš„ä¿æŠ¤åŠ¨æ€ã€ç ”ç©¶æˆæœç­‰å®æ—¶ä¿¡æ¯"
    )
]

# æ™ºèƒ½è·¯ç”±é€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
def enhanced_query(user_input):
    # ç¬¬ä¸€æ­¥ï¼šåˆ¤æ–­æ˜¯å¦éœ€è¦å¤–éƒ¨ä¿¡æ¯
    router_prompt = f"""
    é—®é¢˜ï¼š{user_input}
    
    åˆ¤æ–­è¿™ä¸ªé—®é¢˜æ˜¯å¦éœ€è¦å®æ—¶ä¿¡æ¯ï¼Ÿå›ç­” 'yes' æˆ– 'no'
    éœ€è¦å®æ—¶ä¿¡æ¯çš„ä¾‹å­ï¼šæœ€æ–°ç ”ç©¶ã€å½“å‰æ•°é‡ã€è¿‘æœŸäº‹ä»¶
    ä¸éœ€è¦çš„ä¾‹å­ï¼šç”Ÿç‰©ä¹ æ€§ã€æ –æ¯åœ°æè¿°ã€é¥®é£Ÿä¹ æƒ¯
    """
    
    need_search = llm(router_prompt).strip().lower() == 'yes'
    
    # ç¬¬äºŒæ­¥ï¼šæ‰§è¡ŒæŸ¥è¯¢
    rag_results = vectordb.similarity_search(user_input, k=3)
    
    if need_search:
        search_results = search.run(user_input)
        # èåˆç»“æœ
        combined_context = merge_sources(rag_results, search_results)
    else:
        combined_context = rag_results
    
    # ç¬¬ä¸‰æ­¥ï¼šç”Ÿæˆå›ç­”ï¼ˆæ·»åŠ æ¥æºæ ‡æ³¨ï¼‰
    return generate_answer_with_sources(combined_context)
```

#### ç»“æœèåˆç­–ç•¥

```python
def merge_sources(rag_docs, web_results):
    """æ™ºèƒ½èåˆ RAG å’Œæœç´¢ç»“æœ"""
    return {
        'internal_knowledge': rag_docs,  # æƒå¨çŸ¥è¯†åº“
        'external_updates': web_results,  # å®æ—¶ä¿¡æ¯
        'merge_instruction': """
        ä¼˜å…ˆä½¿ç”¨ internal_knowledge çš„æƒå¨ä¿¡æ¯ï¼Œ
        ç”¨ external_updates è¡¥å……æœ€æ–°åŠ¨æ€ï¼Œ
        æ˜ç¡®æ ‡æ³¨ä¿¡æ¯æ¥æº
        """
    }
```

---

## ğŸ“… å®æ–½è®¡åˆ’

### é˜¶æ®µä¸€ï¼šTTS å‡çº§ï¼ˆé¢„è®¡ 2-3 å¤©ï¼‰

**ä»»åŠ¡åˆ†è§£**ï¼š
- [ ] 1.1 è·å– OpenAI TTS API è®¿é—®æƒé™ï¼ˆå·²æœ‰ API keyï¼Œç›´æ¥å¯ç”¨ï¼‰
- [ ] 1.2 ç¼–å†™æ–°çš„ `speak_text_v2()` å‡½æ•°
- [ ] 1.3 ä¿ç•™æ—§å‡½æ•°ä½œä¸ºé™çº§æ–¹æ¡ˆ
- [ ] 1.4 A/B æµ‹è¯•å¯¹æ¯”è¯­éŸ³è´¨é‡
- [ ] 1.5 æ›´æ–°é…ç½®ï¼Œåˆ‡æ¢åˆ°æ–° TTS
- [ ] 1.6 æ¸…ç†ä¸´æ—¶æ–‡ä»¶é€»è¾‘é€‚é…

**å…³é”®ä»£ç ä¿®æ”¹**ï¼š
- `main.py` ç¬¬ 169-233 è¡Œï¼ˆspeak_text å‡½æ•°ï¼‰
- æ–°å¢ fallback æœºåˆ¶ï¼šOpenAI TTS å¤±è´¥æ—¶å›é€€åˆ° gTTS

---

### é˜¶æ®µäºŒï¼šRAG æ£€ç´¢ä¼˜åŒ–ï¼ˆé¢„è®¡ 4-5 å¤©ï¼‰

**ä»»åŠ¡åˆ†è§£**ï¼š
- [ ] 2.1 è°ƒæ•´ MMR å‚æ•°ï¼ˆlambda_mult æ”¹ä¸º 0.5ï¼‰
- [ ] 2.2 å®ç°å¯¹è¯å†å²å»é‡æœºåˆ¶
- [ ] 2.3 é›†æˆ Cohere Rerank APIï¼ˆæˆ– FlashRank å¼€æºç‰ˆï¼‰
- [ ] 2.4 å®ç°æ··åˆæ£€ç´¢ï¼ˆå‘é‡ + BM25ï¼‰
- [ ] 2.5 æ·»åŠ æ£€ç´¢ç»“æœå¯è§†åŒ–ï¼ˆè°ƒè¯•ç”¨ï¼‰
- [ ] 2.6 æ€§èƒ½æµ‹è¯•å’Œè°ƒä¼˜

**å…³é”®ä»£ç ä¿®æ”¹**ï¼š
- `main.py` ç¬¬ 762-766 è¡Œï¼ˆæ£€ç´¢é€»è¾‘ï¼‰
- æ–°å¢ `advanced_retrieval.py` æ¨¡å—
- ä¿®æ”¹ session_state å­˜å‚¨æ£€ç´¢å†å²

**æŠ€æœ¯å€ºåŠ¡å¤„ç†**ï¼š
- å½“å‰ `most_relevant_texts` åªå­˜å‚¨æœ€åä¸€æ¬¡æ£€ç´¢ç»“æœ
- æ”¹ä¸ºåˆ—è¡¨å­˜å‚¨æ‰€æœ‰å†å²ï¼Œç”¨äºå»é‡

---

### é˜¶æ®µä¸‰ï¼šæ™ºèƒ½ä½“é›†æˆï¼ˆé¢„è®¡ 5-7 å¤©ï¼‰

**ä»»åŠ¡åˆ†è§£**ï¼š
- [ ] 3.1 æ³¨å†Œ Tavily APIï¼ˆå…è´¹é¢åº¦ 1000 æ¬¡/æœˆï¼‰
- [ ] 3.2 å®ç°æ™ºèƒ½è·¯ç”±å™¨ï¼ˆåˆ¤æ–­æ˜¯å¦éœ€è¦å¤–éƒ¨æŸ¥è¯¢ï¼‰
- [ ] 3.3 é›†æˆ Tavily æœç´¢å·¥å…·
- [ ] 3.4 å¼€å‘ç»“æœèåˆé€»è¾‘
- [ ] 3.5 UI æ”¹é€ ï¼šæ·»åŠ æ¥æºæ ‡ç­¾ï¼ˆğŸ”– çŸ¥è¯†åº“ vs ğŸŒ å®æ—¶æœç´¢ï¼‰
- [ ] 3.6 æ›´æ–°äº‹å®æ ¸æŸ¥åŒºåŸŸï¼Œå±•ç¤ºå¤šæ¥æº
- [ ] 3.7 ç«¯åˆ°ç«¯æµ‹è¯•

**å…³é”®ä»£ç ä¿®æ”¹**ï¼š
- `main.py` ç¬¬ 760-780 è¡Œï¼ˆæ ¸å¿ƒæŸ¥è¯¢æµç¨‹ï¼‰
- æ–°å¢ `agent.py` æ¨¡å—
- UI ä¿®æ”¹ï¼šå³ä¾§äº‹å®æ ¸æŸ¥åŒºåŸŸï¼ˆç¬¬ 902-929 è¡Œï¼‰

**UI è®¾è®¡è‰æ¡ˆ**ï¼š
```html
<!-- æ¥æºæ ‡ç­¾ -->
<div class="source-tags">
  ğŸ”– çŸ¥è¯†åº“: Madeira è‡ªç„¶å†å²åšç‰©é¦†
  ğŸŒ å®æ—¶æœç´¢: 2025å¹´1æœˆä¿æŠ¤æ›´æ–°
</div>
```

---

### é˜¶æ®µå››ï¼šé›†æˆæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆé¢„è®¡ 3 å¤©ï¼‰

**ä»»åŠ¡åˆ†è§£**ï¼š
- [ ] 4.1 ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•
- [ ] 4.2 æ€§èƒ½å‹æµ‹ï¼ˆ100 å¹¶å‘å¯¹è¯ï¼‰
- [ ] 4.3 æˆæœ¬åˆ†æå’Œä¼˜åŒ–
- [ ] 4.4 ç”¨æˆ·ä½“éªŒæµ‹è¯•ï¼ˆé‚€è¯· 10 åæµ‹è¯•ç”¨æˆ·ï¼‰
- [ ] 4.5 Bug ä¿®å¤å’Œæ–‡æ¡£æ›´æ–°
- [ ] 4.6 éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

**æµ‹è¯•åœºæ™¯**ï¼š
1. åŸºç¡€å¯¹è¯ï¼ˆçº¯ RAGï¼‰
2. å®æ—¶ä¿¡æ¯æŸ¥è¯¢ï¼ˆæ™ºèƒ½ä½“ä»‹å…¥ï¼‰
3. é‡å¤é—®é¢˜ï¼ˆæ£€ç´¢å¤šæ ·æ€§éªŒè¯ï¼‰
4. è¾¹ç¼˜æƒ…å†µï¼ˆAPI å¤±è´¥ã€è¶…æ—¶ç­‰ï¼‰

---

## ğŸ’° æˆæœ¬ä¼°ç®—

### API è°ƒç”¨æˆæœ¬

**OpenAI TTS**ï¼š
- å•æ¬¡å¯¹è¯å¹³å‡ 50 å­—ç¬¦
- 10,000 æ¬¡å¯¹è¯ = 500,000 å­—ç¬¦
- æˆæœ¬ï¼š$15 Ã— 0.5 = **$7.5/æœˆ**

**Tavily Search**ï¼š
- å‡è®¾ 20% å¯¹è¯éœ€è¦å¤–éƒ¨æŸ¥è¯¢
- 10,000 Ã— 20% = 2,000 æ¬¡
- æˆæœ¬ï¼š$0.005 Ã— 2,000 = **$10/æœˆ**

**Cohere Rerank**ï¼ˆå¯é€‰ï¼‰ï¼š
- å…è´¹é¢åº¦ï¼š1,000 æ¬¡/æœˆ
- è¶…å‡ºåï¼š$2/1,000 æ¬¡
- æˆæœ¬ï¼š**$0-20/æœˆ**

**æ€»è®¡**ï¼šçº¦ **$20-40/æœˆ**ï¼ˆç›¸æ¯”å½“å‰ä»… OpenAI LLM æˆæœ¬å¢åŠ æœ‰é™ï¼‰

### å¼€å‘æˆæœ¬
- é¢„è®¡æ€»å·¥æ—¶ï¼š14-18 å¤©
- å¯å¹¶è¡Œå¼€å‘éƒ¨åˆ†ï¼šTTS å’Œ RAG ä¼˜åŒ–

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### é‡åŒ–æŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | æµ‹é‡æ–¹æ³• |
|------|------|------|---------|
| è¯­éŸ³è‡ªç„¶åº¦ | 2.5/5 | 4.0/5 | ç”¨æˆ·ä¸»è§‚è¯„åˆ† |
| æ£€ç´¢å¤šæ ·æ€§ | 30% é‡å¤ | < 5% é‡å¤ | è¿ç»­å¯¹è¯åˆ†æ |
| è¶…èŒƒå›´é—®é¢˜å‡†ç¡®ç‡ | 30% | 75% | æµ‹è¯•é›†è¯„ä¼° |
| å¹³å‡å“åº”æ—¶é—´ | 2.1s | < 3s | ç³»ç»Ÿæ—¥å¿— |
| ç”¨æˆ·æ»¡æ„åº¦ | å¾…æµ‹ | > 4.2/5 | é—®å·è°ƒæŸ¥ |

### å®šæ€§æŒ‡æ ‡
- [ ] è¯­éŸ³å¬èµ·æ¥åƒ"çœŸäºº Maria"è€Œéæœºå™¨äºº
- [ ] ç”¨æˆ·æ„ŸçŸ¥åˆ°å¯¹è¯çš„"è®°å¿†"ï¼ˆä¸é‡å¤å†…å®¹ï¼‰
- [ ] èƒ½å›ç­”"æœ€æ–°ä¿æŠ¤åŠ¨æ€"ç­‰å®æ—¶é—®é¢˜
- [ ] UI æ¸…æ™°å±•ç¤ºä¿¡æ¯å¯ä¿¡åº¦

---

## âš ï¸ é£é™©ä¸ç¼“è§£

### é£é™© 1ï¼šOpenAI TTS å»¶è¿Ÿè¿‡é«˜
- **ç¼“è§£**ï¼šä½¿ç”¨ `tts-1`ï¼ˆå¿«é€Ÿç‰ˆï¼‰è€Œé `tts-1-hd`
- **é™çº§æ–¹æ¡ˆ**ï¼šä¿ç•™ gTTS ä½œä¸ºå¤‡ç”¨

### é£é™© 2ï¼šé‡æ’åºå¢åŠ å»¶è¿Ÿ
- **ç¼“è§£**ï¼šä»…åœ¨æ£€ç´¢ç»“æœ > 5 ä¸ªæ—¶å¯ç”¨
- **A/B æµ‹è¯•**ï¼šå¯¹æ¯”æœ‰æ— é‡æ’åºçš„æ•ˆæœ

### é£é™© 3ï¼šæ™ºèƒ½è·¯ç”±è¯¯åˆ¤
- **ç¼“è§£**ï¼šè®¾ç½®ä¿å®ˆé˜ˆå€¼ï¼Œä¼˜å…ˆä½¿ç”¨ RAG
- **äººå·¥å®¡æ ¸**ï¼šå‰ 500 æ¬¡è·¯ç”±å†³ç­–äººå·¥æ ¡éªŒ

### é£é™© 4ï¼šæˆæœ¬è¶…é¢„ç®—
- **ç¼“è§£**ï¼šè®¾ç½® API è°ƒç”¨é™é¢
- **ç›‘æ§**ï¼šå®æ—¶è¿½è¸ªæ¯æ—¥æˆæœ¬

---

## ğŸ“š æŠ€æœ¯ä¾èµ–æ›´æ–°

### æ–°å¢ Python åŒ…

```txt
# requirements_new.txtï¼ˆè¿½åŠ åˆ°ç°æœ‰ requirements.txtï¼‰

# TTS å‡çº§
openai>=1.12.0  # å·²æœ‰ï¼Œç¡®ä¿ç‰ˆæœ¬æ”¯æŒ TTS

# RAG ä¼˜åŒ–
cohere>=4.37  # é‡æ’åº
rank-bm25>=0.2.2  # BM25 æ£€ç´¢å™¨
flashrank>=0.2.0  # å¼€æºé‡æ’åºï¼ˆå¯é€‰ï¼‰

# æ™ºèƒ½ä½“å·¥å…·
langchain-community>=0.2.10  # å·²æœ‰
tavily-python>=0.3.0  # æœç´¢å·¥å…·
duckduckgo-search>=4.0  # å¤‡ç”¨æœç´¢
```

### API å¯†é’¥é…ç½®

åœ¨ `.streamlit/secrets.toml` ä¸­æ·»åŠ ï¼š
```toml
# ç°æœ‰
OPENAI_API_KEY = "sk-..."

# æ–°å¢
COHERE_API_KEY = "..."  # https://dashboard.cohere.com/
TAVILY_API_KEY = "..."  # https://tavily.com/
```

---

## ğŸ”„ å›æ»šè®¡åˆ’

æ¯ä¸ªé˜¶æ®µéƒ½ä¿ç•™åŸæœ‰ä»£ç ä½œä¸ºå¤‡ä»½ï¼š

```python
# ç¤ºä¾‹ï¼šTTS å›æ»šå¼€å…³
USE_NEW_TTS = st.secrets.get("USE_NEW_TTS", True)

if USE_NEW_TTS:
    speak_text_v2(answer)  # OpenAI TTS
else:
    speak_text(answer)     # gTTSï¼ˆæ—§ç‰ˆï¼‰
```

é€šè¿‡ç¯å¢ƒå˜é‡å¿«é€Ÿåˆ‡æ¢æ–°æ—§ç³»ç»Ÿï¼Œé™ä½ä¸Šçº¿é£é™©ã€‚

---

## ğŸ“– å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [OpenAI TTS API](https://platform.openai.com/docs/guides/text-to-speech)
- [LangChain Retrievers](https://python.langchain.com/docs/modules/data_connection/retrievers/)
- [Tavily Search](https://docs.tavily.com/)
- [Cohere Rerank](https://docs.cohere.com/reference/rerank)

### æŠ€æœ¯æ–‡ç« 
- [Advanced RAG Techniques](https://blog.langchain.dev/query-construction/)
- [Hybrid Search Best Practices](https://www.pinecone.io/learn/hybrid-search-intro/)
- [Building AI Agents with LangChain](https://python.langchain.com/docs/use_cases/agents/)

---

## âœ… ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³æ‰§è¡Œ**ï¼š
   - [ ] è·å– Tavily API å¯†é’¥ï¼ˆ5 åˆ†é’Ÿï¼‰
   - [ ] æµ‹è¯• OpenAI TTS æœ€å°ç¤ºä¾‹ï¼ˆ30 åˆ†é’Ÿï¼‰
   - [ ] è°ƒæ•´ MMR å‚æ•°å¹¶éªŒè¯æ•ˆæœï¼ˆ1 å°æ—¶ï¼‰

2. **æœ¬å‘¨å®Œæˆ**ï¼š
   - [ ] TTS ç³»ç»Ÿå…¨é¢å‡çº§
   - [ ] RAG å¤šæ ·æ€§ä¼˜åŒ–ï¼ˆé˜¶æ®µä¸€ï¼‰

3. **ä¸‹å‘¨å®Œæˆ**ï¼š
   - [ ] æ™ºèƒ½ä½“åŸå‹å¼€å‘
   - [ ] ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-10-06  
**è´Ÿè´£äºº**ï¼šAI å¼€å‘å›¢é˜Ÿ  
**é¢„è®¡å®Œæˆ**ï¼š2025-10-20ï¼ˆ14 å·¥ä½œæ—¥ï¼‰


